<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link id="dynamic-css" rel="stylesheet" href="assets/dashboard.css"> <!-- Default CSS -->
    <script src="https://kit.fontawesome.com/3980f875bb.js" crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <a href="#" onclick="showContent('dashboard')"><i
                    class="fa-solid fa-chart-line"></i>&nbsp;&nbsp;&nbsp;Dashboard</a>
            <a href="#" onclick="showContent('manage-user')"><i
                    class="fa-solid fa-users-line"></i>&nbsp;&nbsp;&nbsp;Manage User</a>
            <a href="#" onclick="showContent('leaderboard')"><i
                    class="fa-solid fa-ranking-star"></i>&nbsp;&nbsp;&nbsp;Leader Board</a>
            <a href="#" onclick="showContent('points-allocation')"><i
                    class="fa-solid fa-coins"></i>&nbsp;&nbsp;&nbsp;Points Allocation</a>
            <a href="#" onclick="showContent('redemption-reward')"><i
                    class="fa-solid fa-gift"></i>&nbsp;&nbsp;&nbsp;Redemption Rewards</a>
            <a href="#" onclick="showContent('pet-bottles')"><i
                    class="fa-solid fa-bottle-water"></i>&nbsp;&nbsp;&nbsp;PET Bottles</a>
            <a href="#" onclick="showContent('manage-rewards')"><i class="fa-solid fa-gift"></i>&nbsp;&nbsp;&nbsp;Manage
                Rewards</a>
            <a href="#" onclick="showContent('sales')"><i
                    class="fa-solid fa-bottle-water"></i>&nbsp;&nbsp;&nbsp;Sales</a>
            <a href="#" onclick="showContent('settings')"><i class="fa-solid fa-gear"></i>&nbsp;&nbsp;&nbsp;Settings</a>
            <a href="index.html"><i class="fa-solid fa-right-from-bracket"></i>&nbsp;&nbsp;&nbsp;Logout</a>
        </div>

        <div class="content" id="content">
            <div class="grid-container">
                <div class="grid-item box1" id="user-count-container">
                    <div class="user-count-text" id="user-count-text">Total Users:</div>
                    <div class="user-count-number" id="user-count">Loading...</div>
                </div>
                <div class="grid-item box2" id="claimed-rewards-container">
                    <div class="claimed-rewards-text" id="claimed-rewards-text">Total Claimed Rewards:</div>
                    <div class="claimed-rewards-number" id="claimed-rewards-count">Loading...</div>
                </div>
                <div class="grid-item box3" id="bottle-contribution-container">
                    <div class="bottle-contribution-text" id="bottle-count-text">Total Bottle Contribution:</div>
                    <div class="bottle-contribution-number" id="bottle-count">Loading...</div>
                </div>
                <div class="grid-item full">
                    <table id="userTable">
                        <thead>
                            <tr>
                                <th>Rank Number</th>
                                <th>Student Number</th>
                                <th>Full Name</th>
                                <th>Bottle Contribution</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
                <div class="grid-item wide">
                    <button onclick="openModal()">Start Scan</button>
                </div>
            </div>
            <div id="userModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <div class="modal-body">
                    <div class="modal-section user-info">
                        <h2>User Information</h2>
                        <img id="userAvatar" src="assets/images/default-profile.png" alt="User Avatar" class="avatar">
                        <div class="user-details">
                            <p>Name:</p>
                            <p id="userName"></p>
                            <p>Student Number:</p>
                            <p id="userStudentNumber"></p>
                        </div>
                        <button id="start-scan-user" class="styled-button">Scan QR</button>
                    </div>
                    <div class="modal-section bottle-info-section" id="bottle-info-section">
                        <h3>Bottle Information</h3>
                        <div class="bottle-table-container">
                            <table id="bottleTable">
                                <thead>
                                    <tr>
                                        <th>No.</th>
                                        <th>Brand Name</th>
                                        <th>Size</th>
                                        <th>Points</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="3" style="text-align:right;"><strong>Total Points:</strong></td>
                                        <td id="totalPoints">0</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="button-container">
                            <button id="start-scan-bottle" class="styled-button disabled-button" disabled>Scan Bottle</button>
                            <button id="confirm-scan-bottle" class="styled-button" style="display: none;">Confirm</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <script>
        async function showContent(section, userId = null) {
            const content = document.getElementById('content');
            const dynamicCss = document.getElementById('dynamic-css');
            switch (section) {
                case 'dashboard':
                    dynamicCss.href = 'assets/dashboard.css';
                    content.innerHTML = `
                        <div class="grid-container">
                            <div class="grid-item box1" id="user-count-container">
                                <div class="user-count-text" id="user-count-text">Total Users:</div>
                                <div class="user-count-number" id="user-count">Loading...</div>
                            </div>
                            <div class="grid-item box2" id="claimed-rewards-container">
                                <div class="claimed-rewards-text" id="claimed-rewards-text">Total Claimed Rewards:</div>
                                <div class="claimed-rewards-number" id="claimed-rewards-count">Loading...</div>
                            </div>
                            <div class="grid-item box3" id="bottle-contribution-container">
                                <div class="bottle-contribution-text" id="bottle-count-text">Total Bottle Contribution:</div>
                                <div class="bottle-contribution-number" id="bottle-count">Loading...</div>
                            </div>
                            <div class="grid-item full">
                                <table id="userTable">
                                    <thead>
                                        <tr>
                                            <th>Rank Number</th>
                                            <th>Student Number</th>
                                            <th>Full Name</th>
                                            <th>Bottle Contribution</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                            <div class="grid-item wide">
                                <button onclick="openModal()">Start Scan</button>
                            </div>
                        </div>
                        <div id="userModal" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="closeModal()">&times;</span>
                            <div class="modal-body">
                                <div class="modal-section user-info">
                                    <h2>User Information</h2>
                                    <img id="userAvatar" src="assets/images/default-profile.png" alt="User Avatar" class="avatar">
                                    <div class="user-details">
                                        <p>Name:</p>
                                        <p id="userName"></p>
                                        <p>Student Number:</p>
                                        <p id="userStudentNumber"></p>
                                    </div>
                                    <button id="start-scan-user" class="styled-button">Scan QR</button>
                                </div>
                                <div class="modal-section bottle-info-section" id="bottle-info-section">
                                    <h3>Bottle Information</h3>
                                    <div class="bottle-table-container">
                                        <table id="bottleTable">
                                            <thead>
                                                <tr>
                                                    <th>No.</th>
                                                    <th>Brand Name</th>
                                                    <th>Size</th>
                                                    <th>Points</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <td colspan="3" style="text-align:right;"><strong>Total Points:</strong></td>
                                                    <td id="totalPoints">0</td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                    <div class="button-container">
                                        <button id="start-scan-bottle" class="styled-button disabled-button" disabled>Scan Bottle</button>
                                        <button id="confirm-scan-bottle" class="styled-button" style="display: none;">Confirm</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>`;

                    displayUserCount();
                    displayClaimedRewardsCount();
                    displayBottleCount();
                    fetchData();
                    break;
                case 'manage-user':
                    dynamicCss.href = 'assets/manageuser.css';
                    content.innerHTML = `
                        <div class="main-content">
                            <h2>Manage Users</h2>
                            <div class="search-bar">
                                <input type="text" id="search-input" placeholder="Search by full name or student number">
                            </div>
                            <table id="data-table">
                                <thead>
                                    <tr>
                                        <th>Student Number</th>
                                        <th>Full Name</th>
                                        <th>Email</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                            <button id="get-data">Get Data</button> 
                        </div>`;
                    initializeManageUser();
                    break;

                case 'leaderboard':
                    dynamicCss.href = 'assets/leaderboard.css';
                    content.innerHTML = `
                    <div class="main-content">
                        <h2>Leaderboard</h2>
                        <table id="userTable">
                            <thead>
                                <tr>
                                    <th>Rank Number</th>
                                    <th>Full Name</th>
                                    <th>Collected Points
                                        <div class="filter-options">
                                            <label for="leaderboard-filter">View by:</label>
                                            <select id="leaderboard-filter">
                                                <option value="week">This Week</option>
                                                <option value="month">This Month</option>
                                                <option value="year">This Year</option>
                                            </select>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <button id="get-data" style="display:none;">Fetch Data</button>
                    </div>`;
                    initializeLeaderboard();
                    break;
                case 'points-allocation':
                    dynamicCss.href = 'assets/pointsallocation.css';
                    content.innerHTML = `
                    <div class="main-content">
                        <h2>Points Allocation</h2>
                        <div class="search-bar">
                            <input type="text" id="search-input" placeholder="Search by student number">
                        </div>
                        <table id="userTable">
                            <thead>
                                <tr>
                                    <th>Student Number</th>
                                    <th>Full Name</th>
                                    <th>Bottle Count</th>
                                    <th>Total Points</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>`;
                    initializePointsAllocation();
                    break;
                case 'redemption-reward':
                    dynamicCss.href = 'assets/redemptionrewards.css';
                    content.innerHTML = `
                    <div class="main-content">
                        <h2>Redemption Rewards</h2>
                        <div id="status"></div>
                        <button class="Reward" onclick="showContent('add-reward')">Add New Reward</button>
                        <div id="rewards-container" class="rewards-grid">
                            <!-- Rewards will be dynamically displayed here -->
                        </div>
                        <button id="fetch-rewards-btn">Refresh Rewards</button>
                        <!-- Modal for editing reward -->
                        <div id="editModal" class="modal">
                            <div class="modal-content">
                                <span class="close" id="closeEditModal">&times;</span>
                                <h3>Edit Reward</h3>
                                <div class="edit-modal-body">
                                    <div class="image-section">
                                        <img id="editImage" class="reward-image" alt="Reward Image">
                                    </div>
                                    <div class="form-section">
                                        <label for="editName">Reward Name:</label>
                                        <input type="text" id="editName" class="modal-input">
                                        <label for="editStock">Stock:</label>
                                        <input type="number" id="editStock" class="modal-input">
                                        <label for="editPoints">Required Points:</label>
                                        <input type="number" id="editPoints" class="modal-input">
                                        <button id="saveEdit" class="modal-save-button">Save Changes</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>`;
                    initializeRedemptionReward();
                    break;
                case 'pet-bottles':
                    dynamicCss.href = 'assets/petbottles.css';
                    content.innerHTML = `
                    <div class="main-content">
                        <h2>PET Bottles</h2>
                        <div id="status"></div>
                        <button class="AddBottle" onclick="showContent('add-pet-bottle')">Add New Pet Bottle</button>
                        <div id="bottles-container" class="bottles-grid">
                            <!-- Bottles will be dynamically displayed here -->
                        </div>
                        <button id="fetch-bottles-btn">Refresh Bottles</button>
                        <!-- Modal for editing bottle -->
                        <div id="editModal" class="modal">
                            <div class="modal-content">
                                <span class="close" id="closeEditModal">&times;</span>
                                <h3>Edit Bottle</h3>
                                <div class="edit-modal-body">
                                    <div class="image-section">
                                        <img id="editImage" class="bottle-image" alt="Bottle Image">
                                    </div>
                                    <div class="form-section">
                                        <label for="editBrand">Brand Name:</label>
                                        <input type="text" id="editBrand" class="modal-input">
                                        <label for="editsize">Size:</label>
                                        <div class="editsizeinput">
                                            <input type="number" id="editsize" class="modal-input" placeholder="Enter size">
                                            <select id="editsizeunit">
                                                <option value="ml">ml</option>
                                                <option value="L">L</option>
                                                <option value="oz">oz</option>
                                            </select>
                                        </div>
                                        <label for="editweight">Weight:</label>
                                        <div class="editweightinput">
                                            <input type="number" id="editweight" class="modal-input" placeholder="Enter weight">
                                            <select id="editweightunit">
                                                <option value="g">g</option>
                                                <option value="kg">kg</option>
                                                <option value="lbs">lbs</option>
                                            </select>
                                        </div>
                                        <label for="editBarcode">Barcode:</label>
                                        <input type="number" id="editBarcode" class="modal-input">
                                        <label for="editPoints">Points:</label>
                                        <input type="number" id="editPoints" class="modal-input" placeholder="Enter points">
                                        <button id="saveEdit" class="modal-save-button">Save Changes</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>`;
                    initializePetBottles();
                    break;

                case 'manage-rewards':
                    dynamicCss.href = 'assets/manageclaimedrewards.css';
                    content.innerHTML = `
                    <div class="main-content">
                        <h2>Manage Claimed Rewards</h2>
                        <div class="search-bar">
                            <input type="text" id="search-input" placeholder="Search by reward name or barcode">
                            <button id="start-scan">Start Scanning</button>
                        </div>
                        <div class="scanner-status" id="scanner-status">Scanner not connected</div>
                        <h3>To Be Claimed Rewards</h3>
                        <div class="table-container">
                            <table id="to-be-claimed-table">
                                <thead>
                                    <tr>
                                        <th>User Name</th>
                                        <th>Student Number</th>
                                        <th>Barcode</th>
                                        <th>Reward Name</th>
                                        <th>Points</th>
                                        <th>Claimed At</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <h3>Claimed Rewards</h3>
                        <div class="table-container">
                            <table id="claimed-table">
                                <thead>
                                    <tr>
                                        <th>User Name</th>
                                        <th>Student Number</th>
                                        <th>Barcode</th>
                                        <th>Reward Name</th>
                                        <th>Points</th>
                                        <th>Claimed At</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <button id="get-data">Get Data</button>
                    </div>`;
                    initializeClaimedRewards();
                    break;

                case 'sales':
                    dynamicCss.href = 'assets/sales.css';
                    content.innerHTML = '<h1>Sales</h1>';
                    break;
                case 'settings':
                    dynamicCss.href = 'assets/settings.css';
                    content.innerHTML = '<h1>Settings</h1>';
                    break;

                case 'edit-user':
                    dynamicCss.href = 'assets/edituser.css';
                    content.innerHTML = `
                        <div class="main-content">
                            <a href="#" class="back-to-dashboard" onclick="showContent('manage-user')">
                                <i class="fa-solid fa-arrow-left"></i>
                            </a>
                            <h2>Edit User</h2>
                            <form id="edit-user-form">
                                <label for="studentNumber">Student Number:</label>
                                <input type="text" id="studentNumber" name="studentNumber">
                                <label for="name">Full Name:</label>
                                <input type="text" id="name" name="name">
                                <label for="email">Email:</label>
                                <input type="email" id="email" name="email">
                                <button type="submit">Update User</button>
                            </form>
                        </div>`;
                    initializeEditUser(userId);
                    break;

                case 'add-reward':
                    dynamicCss.href = 'assets/addreward.css';
                    content.innerHTML = `
                    <div class="main-content">
                        <a href="#" class="back-to-dashboard" onclick="showContent('redemption-reward')">
                            <i class="fa-solid fa-arrow-left"></i>
                        </a>

                        <h2>Add New Reward</h2>
                        <form id="addRewardForm" enctype="multipart/form-data">
                            <label for="reward_name">Reward Name:</label>
                            <input type="text" id="reward_name" name="reward_name" required>

                            <label for="stock">Stock:</label>
                            <input type="number" id="stock" name="stock" required>

                            <label for="points">Required Points:</label>
                            <input type="number" id="points" name="points" required>

                            <label for="image">Reward Image:</label>
                            <input type="file" id="image" name="image" accept="image/*" required>

                            <button type="submit">Add Reward</button>
                        </form>
                    </div>`;
                    initializeAddReward();
                    break;

                case 'add-pet-bottle':
                    dynamicCss.href = 'assets/addpetbottles.css';
                    content.innerHTML = `
                    <div class="main-content">
                        <a href="#" class="back-to-dashboard" onclick="showContent('pet-bottles')">
                            <i class="fa-solid fa-arrow-left"></i>
                        </a>

                        <h2>Add New Pet Bottle</h2>
                        <form id="addBottleForm" enctype="multipart/form-data">
                            <label for="brandname">Brand Name:</label>
                            <input type="text" id="brandname" name="brandname" required>

                            <label for="bottleSize">Size:</label>
                            <input type="number" id="bottleSize" required placeholder="Enter size">
                            <select id="bottleSizeUnit" name="bottleSizeUnit" required>
                                <option value="ml">ml</option>
                                <option value="L">L</option>
                                <option value="oz">oz</option>
                            </select>

                            <label for="bottleWeight">Weight:</label>
                            <input type="number" id="bottleWeight" required placeholder="Enter weight">
                            <select id="bottleWeightUnit" name="bottleWeightUnit" required>
                                <option value="g">g</option>
                                <option value="kg">kg</option>
                                <option value="lbs">lbs</option>
                            </select>

                            <label for="barcodenumber">Barcode Number:</label>
                            <input type="number" id="barcodenumber" name="barcodenumber" required>

                            <label for="points">Points:</label>
                            <input type="number" id="points" name="points" required placeholder="Enter points">

                            <label for="image">Bottle Image:</label>
                            <input type="file" id="image" name="image" accept="image/*" required>

                            <button type="submit">Add Bottle</button>
                        </form>
                    </div>`;
                    initializeAddPetBottle();
                    break;

                default:
                    content.innerHTML = '';
            }
        }

        // FUNCTION FOR DASHBOARD
        async function displayUserCount() {
            try {
                const userCount = await window.electronAPI.getUserCount();
                document.getElementById('user-count-text').textContent = 'Total Users:';
                document.getElementById('user-count').textContent = userCount;
            } catch (error) {
                console.error('Error fetching user count:', error);
                document.getElementById('user-count-text').textContent = 'Total Users:';
                document.getElementById('user-count').textContent = 'Error loading user count';
            }
        }

        async function displayClaimedRewardsCount() {
            try {
                const claimedCount = await window.electronAPI.getClaimedRewardsCount();
                document.getElementById('claimed-rewards-text').textContent = 'Total Claimed Rewards:';
                document.getElementById('claimed-rewards-count').textContent = claimedCount;
            } catch (error) {
                console.error('Error fetching claimed rewards count:', error);
                document.getElementById('claimed-rewards-text').textContent = 'Total Claimed Rewards:';
                document.getElementById('claimed-rewards-count').textContent = 'Error loading claimed rewards count';
            }
        }

        async function displayBottleCount() {
            try {
                const bottleCount = await window.electronAPI.getTotalBottleCount();
                document.getElementById('bottle-count-text').textContent = 'Total Bottle Count:';
                document.getElementById('bottle-count').textContent = bottleCount;
            } catch (error) {
                console.error('Error fetching bottle count:', error);
                document.getElementById('bottle-count-text').textContent = 'Total Bottle Count:';
                document.getElementById('bottle-count').textContent = 'Error loading bottle count';
            }
        }

        async function fetchData() {
            try {
                const data = await window.electronAPI.getUserPoints();
                console.log('Data received in renderer:', data);
                const aggregatedData = aggregateData(data);
                updateTable(aggregatedData);
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        function aggregateData(data) {
            const aggregatedData = {};

            data.forEach(user => {
                if (!aggregatedData[user.studentNumber]) {
                    aggregatedData[user.studentNumber] = {
                        studentNumber: user.studentNumber,
                        name: user.name,
                        bottleCount: 0,
                        totalPoints: 0
                    };
                }
                aggregatedData[user.studentNumber].bottleCount += user.bottleCount || 0;
                aggregatedData[user.studentNumber].totalPoints += user.totalPoints || 0;
            });

            return Object.values(aggregatedData);
        }

        function updateTable(data) {
            data.sort((a, b) => b.bottleCount - a.bottleCount);
            const dataTableBody = document.querySelector('#userTable tbody');
            dataTableBody.innerHTML = '';
            data.forEach((user, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${user.studentNumber}</td>
                    <td>${user.name}</td>
                    <td>${user.bottleCount || 0}</td>
                `;
                dataTableBody.appendChild(row);
            });
        }

        function openModal() {
            document.getElementById('userModal').style.display = 'block';
            document.getElementById('bottle-info-section').style.display = 'block';
            startScanBottleButton.classList.add('disabled-button');
            startScanBottleButton.disabled = true;
            confirmScanBottleButton.style.display = 'none';
        }

        function closeModal() {
            document.getElementById('userModal').style.display = 'none';
        }

        let currentUserId = null;

        async function displayUserInfo(id) {
            try {
                console.log('Fetching user info for user ID:', id);
                const data = await window.electronAPI.getData();
                console.log('Fetched data:', data);
                const user = data.find(user => user.id === id);
                console.log('Found user:', user);
                if (user) {
                    currentUserId = user.id;
                    document.getElementById('userName').textContent = user.name;
                    document.getElementById('userStudentNumber').textContent = user.studentNumber;
                    document.getElementById('userAvatar').src = user.avatar || 'assets/images/default-profile.png';
                    startScanBottleButton.classList.remove('disabled-button');
                    startScanBottleButton.disabled = false;
                    confirmScanBottleButton.style.display = 'inline-block';

                    startScanUserButton.disabled = true;
                } else {
                    console.error('No such user!');
                }
            } catch (error) {
                console.error('Error fetching user info:', error);
            }
        }

        let bottleCounter = 1;
        let totalPoints = 0;

        async function addBottleInfo(barcode_number) {
            try {
                const data = await window.electronAPI.getPetBottles();
                const bottle = data.find(bottle => bottle.barcode_number === barcode_number);
                if (bottle) {
                    const bottleTableBody = document.querySelector('#bottleTable tbody');
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${bottleCounter++}</td> <!-- Sequential numbering -->
                        <td>${bottle.brand_name}</td>
                        <td>${bottle.size} ${bottle.size_unit}</td>
                        <td>${bottle.points}</td>
                    `;
                    bottleTableBody.appendChild(row);

                    totalPoints += Number(bottle.points);
                    document.getElementById('totalPoints').textContent = totalPoints;
                } else {
                    console.error('No such bottle!');
                }
            } catch (error) {
                console.error('Error fetching bottle info:', error);
            }
        }

        async function storeUserPoints() {
            const userName = document.getElementById('userName').textContent;
            const userStudentNumber = document.getElementById('userStudentNumber').textContent;
            const userAvatar = document.getElementById('userAvatar').src;
            const totalPoints = document.getElementById('totalPoints').textContent;
            const bottleCount = bottleCounter - 1;

            const timestamp = new Date().toLocaleString('en-US', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });

            try {
                await window.electronAPI.storeUserPoints({
                    id: currentUserId,
                    name: userName,
                    studentNumber: userStudentNumber,
                    avatar: userAvatar,
                    totalPoints: Number(totalPoints),
                    bottleCount: bottleCount,
                    timestamp: timestamp
                });
                alert('Data stored successfully!');
                resetModal();
            } catch (error) {
                console.error('Error storing data:', error);
                alert('Error storing data.');
            }
        }

        function resetModal() {
            document.getElementById('userName').textContent = '';
            document.getElementById('userStudentNumber').textContent = '';
            document.getElementById('userAvatar').src = 'assets/images/default-profile.png';

            const bottleTableBody = document.querySelector('#bottleTable tbody');
            bottleTableBody.innerHTML = '';
            document.getElementById('totalPoints').textContent = '0';
            startScanBottleButton.disabled = true;
            confirmScanBottleButton.style.display = 'none';

            bottleCounter = 1;
            totalPoints = 0;

            startScanUserButton.disabled = false;
        }

        let barcodeInput = '';
        document.addEventListener('keydown', async (event) => {
            if (isScanningUser || isScanningBottle) {
                if (event.key === 'Enter') {
                    console.log('Barcode scanned:', barcodeInput);
                    if (isScanningUser) {
                        await displayUserInfo(barcodeInput);
                        isScanningUser = false;
                    } else if (isScanningBottle) {
                        await addBottleInfo(barcodeInput);
                    }
                    barcodeInput = '';
                } else {
                    barcodeInput += event.key;
                }
            }
        });

        const startScanUserButton = document.getElementById('start-scan-user');
        const startScanBottleButton = document.getElementById('start-scan-bottle');
        const confirmScanBottleButton = document.getElementById('confirm-scan-bottle');

        startScanUserButton.addEventListener('click', () => {
            isScanningUser = true;
            alert('Scanner connected. Ready to scan user QR code.');
        });


        //START TO SCAN FOR MODAL IN DASHBOARD
        startScanBottleButton.addEventListener('click', () => {
            isScanningBottle = true;
            alert('Scanner connected. Ready to scan bottle barcode.');
        });

        confirmScanBottleButton.addEventListener('click', async () => {
            isScanningBottle = false;
            await storeUserPoints();
        });

        function openModal() {
            document.getElementById('userModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('userModal').style.display = 'none';
        }

        // Initialize the dashboard on load
        showContent('dashboard');

        // FUNCTION FOR MANAGE USER

        function initializeManageUser() {
            const getDataButton = document.getElementById('get-data');
            const dataTableBody = document.querySelector('#data-table tbody');
            const searchInput = document.getElementById('search-input');

            // Fetch and display data in the table
            async function fetchData() {
                try {
                    const data = await window.electronAPI.getData();
                    console.log('Data received in renderer:', data);
                    updateTable(data); // Update table with fetched data
                } catch (error) {
                    console.error('Error fetching data:', error);
                }
            }

            // Update table with user data
            function updateTable(data) {
                // Clear previous table rows
                dataTableBody.innerHTML = '';
                data.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.studentNumber}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>
                            <button class="edit-user" data-id="${user.id}">Edit</button>
                            <button class="delete-user" data-id="${user.id}">Delete</button>
                        </td>
                    `;
                    dataTableBody.appendChild(row);
                });
                attachEventHandlers(); // Reattach event handlers for both edit and delete
            }

            // Fetch and display data on button click (or on page load)
            getDataButton.addEventListener('click', fetchData);

            // Search functionality
            searchInput.addEventListener('input', async () => {
                const query = searchInput.value.toLowerCase();
                const data = await window.electronAPI.getData(); // Fetch all data
                const filteredData = data.filter(user => {
                    return user.name.toLowerCase().includes(query) || user.studentNumber.toString().includes(query);
                });
                updateTable(filteredData); // Update table with filtered data
            });

            // Attach event handlers to edit and delete buttons
            function attachEventHandlers() {
                // Handle Edit button
                document.querySelectorAll('.edit-user').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const userId = event.target.getAttribute('data-id');
                        showContent('edit-user', userId);
                    });
                });

                // Handle Delete button
                document.querySelectorAll('.delete-user').forEach(button => {
                    button.addEventListener('click', async (event) => {
                        const userId = event.target.getAttribute('data-id');
                        try {
                            await window.electronAPI.deleteUser(userId);
                            alert('User deleted successfully');
                            const row = event.target.closest('tr');
                            row.remove(); // Immediately remove the row from the UI
                        } catch (error) {
                            console.error('Error deleting user:', error);
                        }
                    });
                });
            }

            // Auto-fetch data when page loads
            getDataButton.click();
        }

        //FUNCTION FOR LEADERBOARD
        function initializeManageUser() {
            const getDataButton = document.getElementById('get-data');
            const dataTableBody = document.querySelector('#data-table tbody');
            const searchInput = document.getElementById('search-input');

            // Fetch and display data in the table
            async function fetchData() {
                try {
                    const data = await window.electronAPI.getData();
                    console.log('Data received in renderer:', data);
                    updateTable(data); // Update table with fetched data
                } catch (error) {
                    console.error('Error fetching data:', error);
                }
            }

            // Update table with user data
            function updateTable(data) {
                // Clear previous table rows
                dataTableBody.innerHTML = '';
                data.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                    <td>${user.studentNumber}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>
                        <button class="edit-user" data-id="${user.id}">Edit</button>
                        <button class="delete-user" data-id="${user.id}">Delete</button>
                    </td>
                `;
                    dataTableBody.appendChild(row);
                });
                attachEventHandlers(); // Reattach event handlers for both edit and delete
            }

            // Fetch and display data on button click (or on page load)
            getDataButton.addEventListener('click', fetchData);

            // Search functionality
            searchInput.addEventListener('input', async () => {
                const query = searchInput.value.toLowerCase();
                const data = await window.electronAPI.getData(); // Fetch all data
                const filteredData = data.filter(user => {
                    return user.name.toLowerCase().includes(query) || user.studentNumber.toString().includes(query);
                });
                updateTable(filteredData); // Update table with filtered data
            });

            // Attach event handlers to edit and delete buttons
            function attachEventHandlers() {
                // Handle Edit button
                document.querySelectorAll('.edit-user').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const userId = event.target.getAttribute('data-id');
                        showContent('edit-user', userId);
                    });
                });

                // Handle Delete button
                document.querySelectorAll('.delete-user').forEach(button => {
                    button.addEventListener('click', async (event) => {
                        const userId = event.target.getAttribute('data-id');
                        try {
                            await window.electronAPI.deleteUser(userId);
                            alert('User deleted successfully');
                            const row = event.target.closest('tr');
                            row.remove(); // Immediately remove the row from the UI
                        } catch (error) {
                            console.error('Error deleting user:', error);
                        }
                    });
                });
            }

            // Auto-fetch data when page loads
            getDataButton.click();
        }

        function initializeLeaderboard() {
            const dataTableBody = document.querySelector('#userTable tbody');

            // Fetch and display data in the table
            async function fetchData() {
                try {
                    const data = await window.electronAPI.getUserPoints();
                    console.log('Data received in renderer:', data);
                    const aggregatedData = aggregateData(data);
                    updateTable(aggregatedData); // Update table with aggregated data
                } catch (error) {
                    console.error('Error fetching data:', error);
                }
            }

            // Aggregate data by name
            function aggregateData(data) {
                const aggregatedData = {};

                data.forEach(user => {
                    if (!aggregatedData[user.name]) {
                        aggregatedData[user.name] = {
                            name: user.name,
                            bottleCount: 0,
                            totalPoints: 0
                        };
                    }
                    aggregatedData[user.name].bottleCount += user.bottleCount || 0;
                    aggregatedData[user.name].totalPoints += user.totalPoints || 0;
                });

                return Object.values(aggregatedData);
            }

            // Update table with user data
            function updateTable(data) {
                // Sort data by total points in descending order
                data.sort((a, b) => b.totalPoints - a.totalPoints);

                dataTableBody.innerHTML = '';
                data.forEach((user, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${user.name}</td>
                        <td>${user.totalPoints || 0}</td>
                    `;
                    dataTableBody.appendChild(row);
                });
            }

            // Auto-fetch data when page loads
            fetchData();
        }

        //FUNCTION FOR POINTS ALLOCATION
        function initializePointsAllocation() {
            const dataTableBody = document.querySelector('#userTable tbody');
            const searchInput = document.getElementById('search-input');

            // Fetch and display data in the table
            async function fetchData() {
                try {
                    const data = await window.electronAPI.getUserPoints();
                    console.log('Data received in renderer:', data);
                    const aggregatedData = aggregateData(data);
                    updateTable(aggregatedData); // Update table with aggregated data
                } catch (error) {
                    console.error('Error fetching data:', error);
                }
            }

            // Aggregate data by student number
            function aggregateData(data) {
                const aggregatedData = {};

                data.forEach(user => {
                    if (!aggregatedData[user.studentNumber]) {
                        aggregatedData[user.studentNumber] = {
                            studentNumber: user.studentNumber,
                            name: user.name,
                            bottleCount: 0,
                            totalPoints: 0
                        };
                    }
                    aggregatedData[user.studentNumber].bottleCount += user.bottleCount || 0;
                    aggregatedData[user.studentNumber].totalPoints += user.totalPoints || 0;
                });

                return Object.values(aggregatedData);
            }

            // Update table with user data
            function updateTable(data) {
                // Sort data by total points in descending order
                data.sort((a, b) => b.totalPoints - a.totalPoints);
                // Clear previous table rows
                dataTableBody.innerHTML = '';
                data.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                    <td>${user.studentNumber}</td>
                    <td>${user.name}</td>
                    <td>${user.bottleCount}</td>
                    <td>${user.totalPoints}</td>
                `;
                    dataTableBody.appendChild(row);
                });
            }

            // Search functionality
            searchInput.addEventListener('input', async () => {
                const query = searchInput.value.toLowerCase();
                const data = await window.electronAPI.getUserPoints(); // Fetch all data
                const aggregatedData = aggregateData(data);
                const filteredData = aggregatedData.filter(user => {
                    return user.studentNumber.toString().includes(query); // Filter by student number
                });
                updateTable(filteredData); // Update table with filtered data
            });

            // Auto-fetch data when page loads
            fetchData();
        }

        //FUNCTION FOR REDEMPTION REWARDS

        function initializeRedemptionReward() {
            const rewardsContainer = document.getElementById('rewards-container');
            const statusDiv = document.getElementById('status');
            const editModal = document.getElementById('editModal');
            const closeEditModal = document.getElementById('closeEditModal');
            const editImage = document.getElementById('editImage');
            const editName = document.getElementById('editName');
            const editStock = document.getElementById('editStock');
            const editPoints = document.getElementById('editPoints');
            const saveEdit = document.getElementById('saveEdit');

            // Function to fetch and display rewards
            async function fetchRewards() {
                try {
                    const rewards = await window.electronAPI.getRewards(); // Get rewards from Firebase via Electron API
                    console.log('Rewards received:', rewards);
                    // Clear previous content
                    rewardsContainer.innerHTML = '';

                    // Loop through the rewards and display each one
                    rewards.forEach(reward => {
                        const rewardElement = document.createElement('div');
                        rewardElement.classList.add('reward-item');

                        // Display reward image, name, stock, and action buttons
                        rewardElement.innerHTML = `
                        <div class="reward-image">
                            <img src="${reward.image_url}" alt="${reward.reward_name}" />
                        </div>
                        <div class="reward-details">
                            <h3>${reward.reward_name}</h3>
                            <p>Stock: ${reward.stock}</p>
                            <p>Points: ${reward.points}</p>
                            <button class="edit-button" onclick="openEditModal('${reward.id}', '${reward.reward_name}', ${reward.stock}, ${reward.points}, '${reward.image_url}')">Edit</button>
                            <button class="delete-button" onclick="deleteReward('${reward.id}')">Delete</button>
                        </div>
                    `;

                        rewardsContainer.appendChild(rewardElement);
                    });
                } catch (error) {
                    console.error('Error fetching rewards:', error);
                    statusDiv.innerText = 'Failed to fetch rewards.';
                }
            }

            // Function to open the edit modal
            window.openEditModal = function (id, name, stock, points, imageUrl) {
                editImage.src = imageUrl;
                editName.value = name;
                editStock.value = stock;
                editPoints.value = points;
                editModal.style.display = 'block';

                saveEdit.onclick = async function () {
                    try {
                        await window.electronAPI.updateReward(id, {
                            reward_name: editName.value,
                            stock: editStock.value,
                            points: editPoints.value,
                            image_url: imageUrl
                        });
                        alert('Reward updated successfully');
                        editModal.style.display = 'none';
                        fetchRewards(); // Refresh the rewards list
                    } catch (error) {
                        console.error('Error updating reward:', error);
                        alert('Failed to update reward.');
                    }
                };
            };

            // Function to delete a reward
            window.deleteReward = async function (id) {
                try {
                    await window.electronAPI.deleteReward(id);
                    alert('Reward deleted successfully');
                    fetchRewards(); // Refresh the rewards list
                } catch (error) {
                    console.error('Error deleting reward:', error);
                    alert('Failed to delete reward.');
                }
            };

            // Close the edit modal
            closeEditModal.onclick = function () {
                editModal.style.display = 'none';
            };

            // Fetch rewards on initialization
            fetchRewards();

            // Refresh rewards on button click
            document.getElementById('fetch-rewards-btn').onclick = fetchRewards;
        }

        //FUNCTION FOR PET BOTTLES
        function initializePetBottles() {
            const bottlesContainer = document.getElementById('bottles-container');
            const statusDiv = document.getElementById('status');
            const editModal = document.getElementById('editModal');
            const closeEditModal = document.getElementById('closeEditModal');
            const editImage = document.getElementById('editImage');
            const editBrand = document.getElementById('editBrand');
            const editSize = document.getElementById('editsize');
            const editSizeUnit = document.getElementById('editsizeunit');
            const editWeight = document.getElementById('editweight');
            const editWeightUnit = document.getElementById('editweightunit');
            const editBarcode = document.getElementById('editBarcode');
            const editPoints = document.getElementById('editPoints');
            const saveEdit = document.getElementById('saveEdit');

            // Function to fetch and display bottles
            async function fetchBottles() {
                try {
                    const bottles = await window.electronAPI.getPetBottles();
                    console.log('Bottles received in renderer:', bottles);
                    bottlesContainer.innerHTML = ''; // Clear previous content

                    // Loop through the bottles and display each one
                    bottles.forEach(bottle => {
                        const bottleElement = document.createElement('div');
                        bottleElement.classList.add('bottle-item');

                        // Display bottle image, brand name, size, weight, barcode number, and points
                        bottleElement.innerHTML = `
                        <div class="bottle-image">
                            <img src="${bottle.image_url}" alt="${bottle.brand_name}" />
                        </div>
                        <div class="bottle-details">
                            <h3>${bottle.brand_name}</h3>
                            <p>Size: ${bottle.size} ${bottle.size_unit}</p>
                            <p>Weight: ${bottle.weight} ${bottle.weight_unit}</p>
                            <p>Barcode: ${bottle.barcode_number}</p>
                            <p>Points: ${bottle.points}</p>
                            <button class="edit-button" onclick="editBottle('${bottle.id}', '${bottle.brand_name}', ${bottle.size}, '${bottle.size_unit}', ${bottle.weight}, '${bottle.weight_unit}', '${bottle.barcode_number}', '${bottle.image_url}', ${bottle.points})">Edit</button>
                            <button class="delete-button" onclick="deleteBottle('${bottle.id}')">Delete</button>
                        </div>
                    `;

                        bottlesContainer.appendChild(bottleElement);
                    });
                } catch (error) {
                    console.error('Error fetching bottles:', error);
                    statusDiv.innerText = 'Failed to fetch bottles';
                }
            }

            // Open edit modal
            window.editBottle = function (id, brand_name, size, size_unit, weight, weight_unit, barcode, imageUrl, points) {
                editBrand.value = brand_name;
                editSize.value = size;
                editSizeUnit.value = size_unit;
                editWeight.value = weight;
                editWeightUnit.value = weight_unit;
                editBarcode.value = barcode;
                editPoints.value = points;
                editImage.src = imageUrl;
                editModal.style.display = 'block';

                // Link saveEdit function to the save button
                saveEdit.onclick = () => saveEditBottle(id);
            };

            // Save edited bottle
            async function saveEditBottle(id) {
                const brand_name = editBrand.value;
                const size = editSize.value;
                const size_unit = editSizeUnit.value;
                const weight = editWeight.value;
                const weight_unit = editWeightUnit.value;
                const barcode = editBarcode.value;
                const points = editPoints.value;

                try {
                    await window.electronAPI.editPetBottle(id, brand_name, size, size_unit, weight, weight_unit, barcode, points);
                    editModal.style.display = 'none'; // Close modal
                    fetchBottles(); // Refresh the bottles list to reflect the updated data
                } catch (error) {
                    console.error('Error saving bottle:', error);
                    statusDiv.innerText = 'Failed to save bottle';
                }
            }

            // Delete bottle
            window.deleteBottle = async function (id) {
                const confirmDelete = confirm("Are you sure you want to delete this bottle?");
                if (confirmDelete) {
                    try {
                        await window.electronAPI.deletePetBottle(id); // Delete bottle via Electron API
                        fetchBottles(); // Refresh the bottles list after deletion
                    } catch (error) {
                        console.error('Error deleting bottle:', error);
                        statusDiv.innerText = 'Failed to delete bottle';
                    }
                }
            };

            // Event listener for the fetch bottles button
            document.getElementById('fetch-bottles-btn').addEventListener('click', fetchBottles);

            // Event listener for the close button
            closeEditModal.addEventListener('click', () => {
                editModal.style.display = 'none';
            });

            // Fetch bottles on initialization
            fetchBottles();
        }

        //FUNCTION FOR MANAGE CLAIMED REWARDS
        function initializeClaimedRewards() {
            const getDataButton = document.getElementById('get-data');
            const toBeClaimedTableBody = document.querySelector('#to-be-claimed-table tbody');
            const claimedTableBody = document.querySelector('#claimed-table tbody');
            const searchInput = document.getElementById('search-input');
            const scannerStatus = document.getElementById('scanner-status');
            const startScanButton = document.getElementById('start-scan');
            let claimedRewardsData = [];
            let isScanning = false;

            // Fetch and display data in the tables
            async function fetchData() {
                try {
                    const data = await window.electronAPI.getClaimedRewards();
                    claimedRewardsData = data; // Store the data for later use
                    displayTables(data); // Update both tables with fetched data
                } catch (error) {
                    console.error('Error fetching data:', error);
                }
            }

            // Display data in both "to be claimed" and "claimed" tables
            function displayTables(data) {
                // Filter and sort data for each table
                const toBeClaimedRewards = data
                    .filter(reward => reward.status === 'toBeClaimed')
                    .sort((a, b) => new Date(b.claimedAt) - new Date(a.claimedAt));
                console.log('To Be Claimed Rewards:', toBeClaimedRewards);  // Debugging: View "To Be Claimed" rewards

                const claimedRewards = data
                    .filter(reward => reward.status === 'claimed')
                    .sort((a, b) => new Date(b.claimedAt) - new Date(a.claimedAt));
                console.log('Claimed Rewards:', claimedRewards);  // Debugging: View "Claimed" rewards

                // Update tables with sorted data
                updateTable(toBeClaimedTableBody, toBeClaimedRewards, "To Be Claimed Rewards");
                updateTable(claimedTableBody, claimedRewards, "Claimed Rewards");
            }

            // Update table with reward data
            function updateTable(tableBody, data, status) {
                tableBody.innerHTML = ''; // Clear previous table rows
                if (data.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="8">No ${status.toLowerCase()} available</td>`;
                    tableBody.appendChild(row);
                    return;
                }
                data.forEach(reward => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                    <td>${reward.userName}</td>
                    <td>${reward.studentNumber}</td>
                    <td>${reward.barcode}</td>
                    <td>${reward.name}</td>
                    <td>${reward.points}</td>
                    <td>${new Date(reward.claimedAt).toLocaleString()}</td>
                    <td>${reward.status}</td>
                    <td>
                        <button class="delete-reward" data-id="${reward.id}">Delete</button>
                    </td>
                `;
                    tableBody.appendChild(row);
                });
                attachEventHandlers(); // Attach event handlers for each table's buttons
            }

            // Fetch and display data on button click
            getDataButton.addEventListener('click', fetchData);

            // Attach event handlers to delete buttons
            function attachEventHandlers() {
                document.querySelectorAll('.delete-reward').forEach(button => {
                    button.addEventListener('click', async (event) => {
                        const rewardId = event.target.getAttribute('data-id');
                        try {
                            await window.electronAPI.deleteClaimedReward(rewardId);
                            alert('Reward deleted successfully');
                            fetchData(); // Refresh data after deletion
                        } catch (error) {
                            console.error('Error deleting reward:', error);
                        }
                    });
                });
            }

            // Search functionality
            searchInput.addEventListener('input', () => {
                const query = searchInput.value.toLowerCase();
                const filteredData = claimedRewardsData.filter(reward => {
                    return reward.name.toLowerCase().includes(query) || reward.barcode.toString().includes(query);
                });
                displayTables(filteredData); // Display only matching results in both tables
            });

            // Barcode scanning functionality
            let barcodeInput = '';
            document.addEventListener('keydown', async (event) => {
                if (isScanning) {
                    if (event.key === 'Enter') {
                        handleBarcodeScan(barcodeInput);
                        barcodeInput = ''; // Reset input
                    } else {
                        barcodeInput += event.key;
                    }
                }
            });

            async function handleBarcodeScan(barcode) {
                const reward = claimedRewardsData.find(reward => reward.barcode === barcode);
                if (reward) {
                    try {
                        const currentTime = new Date().toISOString();
                        await window.electronAPI.updateClaimedRewardStatus(reward.id, 'claimed', currentTime);
                        alert(`Reward with barcode ${barcode} marked as claimed.`);
                        fetchData(); // Refresh tables
                    } catch (error) {
                        console.error('Error updating reward status:', error);
                    }
                } else {
                    alert(`No reward found with barcode ${barcode}.`);
                }
            }

            // Start scanning
            startScanButton.addEventListener('click', () => {
                isScanning = true;
                scannerStatus.textContent = 'Scanner connected. Ready to scan.';
                scannerStatus.style.color = 'green';
            });

            // Fetch rewards on initialization
            fetchData();
        }


        //FUNCTION FOR EDIT USER
        function initializeEditUser(userId) {
            // Fetch user data and populate the form
            (async () => {
                if (userId) {
                    try {
                        const userData = await window.electronAPI.getData();  // Call the correct function
                        const user = userData.find(user => user.id === userId);  // Match the user by ID

                        if (user) {
                            document.getElementById('studentNumber').value = user.studentNumber;
                            document.getElementById('name').value = user.name;
                            document.getElementById('email').value = user.email;
                        } else {
                            console.error('User not found.');
                        }
                    } catch (error) {
                        console.error('Error fetching user data:', error);
                    }
                }
            })();

            const form = document.getElementById('edit-user-form');
            form.addEventListener('submit', async (event) => {
                event.preventDefault();

                const updatedData = {
                    studentNumber: document.getElementById('studentNumber').value,
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                };

                try {
                    await window.electronAPI.editUser(userId, updatedData.studentNumber, updatedData.name, updatedData.email);
                    alert('User updated successfully');
                    showContent('manage-user');
                } catch (error) {
                    console.error('Error updating user:', error);
                }
            });
        }

        //FUNCTION FOR ADD REWARD
        function initializeAddReward() {
            const addRewardForm = document.getElementById('addRewardForm');

            const handleFormSubmit = async (event) => {
                event.preventDefault();

                const rewardName = document.getElementById('reward_name').value;
                const rewardStock = document.getElementById('stock').value;
                const rewardPoints = document.getElementById('points').value;
                const rewardImage = document.getElementById('image').files[0];

                if (!rewardImage) {
                    alert('Please select an image');
                    return;
                }

                try {
                    // Read the file content
                    const reader = new FileReader();
                    reader.onload = async function (event) {
                        const fileContent = event.target.result;

                        // Upload image to Firebase Storage
                        const { success: uploadSuccess, imageUrl, error: uploadError } = await window.electronAPI.uploadImage({ fileContent, fileName: rewardImage.name });
                        if (!uploadSuccess) {
                            throw new Error(uploadError);
                        }

                        // Save reward details to Firestore
                        const reward = {
                            reward_name: rewardName,
                            stock: rewardStock,
                            points: rewardPoints,
                            image_url: imageUrl
                        };

                        const { success: addSuccess, error: addError } = await window.electronAPI.addReward(reward);
                        if (!addSuccess) {
                            throw new Error(addError);
                        }

                        alert('Reward added successfully');
                        addRewardForm.reset();
                        showContent('redemption-reward');
                    };
                    reader.readAsArrayBuffer(rewardImage);
                } catch (error) {
                    console.error('Error adding reward:', error);
                    alert('Failed to add reward');
                }
            };

            addRewardForm.addEventListener('submit', handleFormSubmit);

            // Ensure the form is reset when navigating back to this page
            window.addEventListener('pageshow', () => {
                addRewardForm.reset();
            });
        }

        //FUNCTION FOR ADD PET BOTTLE
        function initializeAddPetBottle() {
            const addBottleForm = document.getElementById('addBottleForm');

            const handleFormSubmit = async (event) => {
                event.preventDefault();

                const brandName = document.getElementById('brandname').value;
                const bottleSize = document.getElementById('bottleSize').value;
                const bottleSizeUnit = document.getElementById('bottleSizeUnit').value;
                const bottleWeight = document.getElementById('bottleWeight').value;
                const bottleWeightUnit = document.getElementById('bottleWeightUnit').value;
                const barcodeNumber = document.getElementById('barcodenumber').value;
                const points = document.getElementById('points').value;
                const bottleImage = document.getElementById('image').files[0];

                if (!bottleImage) {
                    alert('Please select an image');
                    return;
                }

                try {
                    // Read the file content
                    const reader = new FileReader();
                    reader.onload = async function (event) {
                        const fileContent = event.target.result;

                        // Upload image to Firebase Storage
                        const { success: uploadSuccess, imageUrl, error: uploadError } = await window.electronAPI.uploadPetBottleImage({ fileContent, fileName: bottleImage.name });
                        if (!uploadSuccess) {
                            throw new Error(uploadError);
                        }

                        // Save pet bottle details to Firestore
                        const petBottle = {
                            brand_name: brandName,
                            size: bottleSize,
                            size_unit: bottleSizeUnit,
                            weight: bottleWeight,
                            weight_unit: bottleWeightUnit,
                            barcode_number: barcodeNumber,
                            points: points,
                            image_url: imageUrl
                        };

                        const { success: addSuccess, error: addError } = await window.electronAPI.addPetBottle(petBottle);
                        if (!addSuccess) {
                            throw new Error(addError);
                        }

                        alert('Pet bottle added successfully');
                        addBottleForm.reset();
                        showContent('pet-bottles');
                    };
                    reader.readAsArrayBuffer(bottleImage);
                } catch (error) {
                    console.error('Error adding pet bottle:', error);
                    alert('Failed to add pet bottle');
                }
            };

            addBottleForm.addEventListener('submit', handleFormSubmit);

            // Ensure the form is reset when navigating back to this page
            window.addEventListener('pageshow', () => {
                addBottleForm.reset();
            });
        }

        // Initialize the dashboard on load
        showContent('dashboard');
    </script>
</body>

</html>